<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>RX5808-Div Firmware Configurator | Flash & Manage FPV Receiver Firmware</title>
    <meta name="description" content="Professional web-based firmware configurator for RX5808 Diversity FPV video receivers. Flash firmware, configure ELRS wireless control, spectrum analyzer, and more‚Äîdirectly from your browser. No software installation required." />
    <meta name="viewport" content="width=device-width" />
    <meta name="color-scheme" content="dark light" />
    <meta name="keywords" content="RX5808, FPV, diversity receiver, firmware configurator, ESP32, ExpressLRS, ELRS backpack, spectrum analyzer, analog video, drone, racing" />
    <meta name="author" content="Lochness_FPV" />
    
    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="RX5808-Div Firmware Configurator" />
    <meta property="og:description" content="Flash and manage firmware for RX5808 Diversity FPV receivers directly from your browser" />
    <meta property="og:url" content="https://lochnessfpv.github.io/RX5808-Div-Configurator/" />
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="RX5808-Div Firmware Configurator" />
    <meta name="twitter:description" content="Flash and manage firmware for RX5808 Diversity FPV receivers directly from your browser" />
    
    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "RX5808-Div Firmware Configurator",
      "applicationCategory": "UtilitiesApplication",
      "operatingSystem": "Web Browser",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "description": "Professional web-based firmware configurator for RX5808 Diversity FPV video receivers",
      "browserRequirements": "Requires Chrome, Edge, or Opera with Web Serial API support",
      "author": {
        "@type": "Person",
        "name": "Lochness_FPV"
      }
    }
    </script>
    
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        padding: 0;
        margin: 0;
        line-height: 1.7;
        background: linear-gradient(to bottom, #f8f9fa 0%, #e9ecef 100%);
        min-height: 100vh;
        transition: background-color 0.3s ease;
      }
      
      .header {
        background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
        color: white;
        padding: 60px 20px;
        text-align: center;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        transition: background 0.3s ease;
      }
      
      .header h1 {
        font-size: 36px;
        font-weight: 600;
        margin-bottom: 12px;
        letter-spacing: -0.5px;
      }
      
      .header p {
        font-size: 18px;
        opacity: 0.95;
        max-width: 700px;
        margin: 0 auto;
        font-weight: 400;
      }
      
      .container {
        max-width: 900px;
        margin: -40px auto 60px;
        padding: 0 20px;
      }
      
      .card {
        background: white;
        border-radius: 8px;
        padding: 32px;
        margin-bottom: 24px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.08), 0 4px 12px rgba(0,0,0,0.05);
        border: 1px solid #e5e7eb;
        transition: all 0.3s ease;
      }
      
      .card:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.1), 0 8px 24px rgba(0,0,0,0.08);
      }
      
      h2 {
        font-size: 24px;
        font-weight: 600;
        color: #111827;
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: color 0.3s ease;
      }
      
      h3 {
        font-size: 18px;
        font-weight: 600;
        color: #374151;
        margin-bottom: 12px;
        transition: color 0.3s ease;
      }
      
      .version-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 16px;
      }
      
      .version-header h2 {
        margin: 0;
      }
      
      .version-selector {
        padding: 10px 16px;
        border-radius: 6px;
        border: 1px solid #d1d5db;
        background: #ffffff;
        color: #111827;
        cursor: pointer;
        font-size: 15px;
        font-weight: 500;
        font-family: inherit;
        min-width: 180px;
        transition: all 0.2s;
      }
      
      .version-selector:hover {
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }
      
      .version-selector:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
      }
      
      .version-selector option {
        padding: 10px;
        background: #ffffff;
        color: #111827;
        font-size: 15px;
      }
      
      .version-info {
        display: flex;
        gap: 24px;
        margin-bottom: 24px;
        padding: 16px;
        background: #f9fafb;
        border-radius: 6px;
        font-size: 14px;
        flex-wrap: wrap;
      }
      
      .version-info span {
        color: #6b7280;
      }
      
      .version-info strong {
        color: #374151;
        font-weight: 600;
      }
      
      esp-web-install-button {
        display: block;
        margin: 20px auto;
      }
      
      .info-box {
        background: #eff6ff;
        border-left: 4px solid #3b82f6;
        padding: 20px;
        border-radius: 6px;
      }
      
      .info-box h3 {
        color: #1e40af;
        font-size: 16px;
        margin-bottom: 12px;
      }
      
      .info-box ul {
        list-style: none;
        padding: 0;
      }
      
      .info-box li {
        color: #1e40af;
        margin: 8px 0;
        padding-left: 24px;
        position: relative;
      }
      
      .info-box li:before {
        content: "‚Ä¢";
        position: absolute;
        left: 8px;
        font-weight: bold;
      }
      
      .footer {
        text-align: center;
        padding: 40px 20px;
        font-size: 14px;
        color: #6b7280;
        border-top: 1px solid #e5e7eb;
        background: #ffffff;
      }
      
      .footer a {
        color: #3b82f6;
        text-decoration: none;
        font-weight: 500;
      }
      
      .footer a:hover {
        color: #2563eb;
        text-decoration: underline;
      }
      
      .release-notes {
        color: #374151;
        line-height: 1.7;
      }
      
      .release-notes h3, .release-notes h4 {
        color: #111827;
        margin-top: 16px;
        margin-bottom: 8px;
      }
      
      .release-notes ul {
        padding-left: 24px;
        margin: 12px 0;
      }
      
      .release-notes li {
        margin: 6px 0;
        color: #4b5563;
      }
      
      .release-notes p {
        margin: 12px 0;
        color: #4b5563;
      }
      
      .features {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 16px;
        margin: 24px 0;
      }
      
      .feature {
        padding: 20px;
        border-radius: 6px;
        border: 1px solid #e5e7eb;
        background: #ffffff;
        transition: all 0.2s;
      }
      
      .feature:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        border-color: #d1d5db;
      }
      
      .feature h3 {
        font-size: 15px;
        font-weight: 600;
        color: #111827;
        margin-bottom: 8px;
      }
      
      .feature p {
        margin: 0;
        font-size: 14px;
        color: #6b7280;
        line-height: 1.6;
      }
      
      .install-button {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        color: white;
        border: none;
        padding: 16px 32px;
        font-size: 16px;
        font-weight: 600;
        border-radius: 8px;
        cursor: pointer;
        width: 100%;
        transition: all 0.3s;
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.25);
      }
      
      .install-button:hover {
        transform: translateY(-1px);
        box-shadow: 0 6px 16px rgba(59, 130, 246, 0.35);
      }
      
      .install-button:active {
        transform: translateY(0);
      }
      
      .install-note {
        text-align: center;
        font-size: 13px;
        color: #6b7280;
        margin-top: 12px;
      }
      
      @media (max-width: 768px) {
        .header h1 {
          font-size: 28px;
        }
        .header p {
          font-size: 16px;
        }
        .card {
          padding: 24px;
        }
        .version-header {
          flex-direction: column;
          align-items: flex-start;
        }
        .version-selector {
          width: 100%;
        }
        .features {
          grid-template-columns: 1fr;
        }
      }
      
      /* Dark Theme */
      @media (prefers-color-scheme: dark) {
        body {
          background: #0f172a;
        }
        
        .header {
          background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        }
        
        .card {
          background: #1e293b;
          border-color: #334155;
        }
        
        h2, h3 {
          color: #f1f5f9;
        }
        
        .version-selector {
          background: #0f172a;
          color: #f1f5f9;
          border-color: #475569;
        }
        
        .version-selector:hover {
          border-color: #60a5fa;
          box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.1);
        }
        
        .version-selector:focus {
          border-color: #60a5fa;
          box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.2);
        }
        
        .version-selector option {
          background: #0f172a;
          color: #f1f5f9;
        }
        
        .version-info {
          background: #0f172a;
        }
        
        .version-info span {
          color: #94a3b8;
        }
        
        .version-info strong {
          color: #cbd5e1;
        }
        
        .info-box {
          background: #0f172a;
          border-left-color: #60a5fa;
        }
        
        .info-box h3 {
          color: #93c5fd;
        }
        
        .info-box li {
          color: #bfdbfe;
        }
        
        .feature {
          background: #0f172a;
          border-color: #334155;
        }
        
        .feature:hover {
          box-shadow: 0 4px 12px rgba(0,0,0,0.3);
          border-color: #475569;
        }
        
        .feature h3 {
          color: #f1f5f9;
        }
        
        .feature p {
          color: #94a3b8;
        }
        
        .install-button {
          background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
          box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
        }
        
        .install-button:hover {
          box-shadow: 0 6px 16px rgba(37, 99, 235, 0.5);
        }
        
        .install-note {
          color: #94a3b8;
        }
        
        .footer {
          background: #1e293b;
          border-top-color: #334155;
          color: #94a3b8;
        }
        
        .footer a {
          color: #60a5fa;
        }
        
        .footer a:hover {
          color: #93c5fd;
        }
        
        .release-notes {
          color: #cbd5e1;
        }
        
        .release-notes h3, .release-notes h4 {
          color: #f1f5f9;
        }
        
        .release-notes li {
          color: #94a3b8;
        }
        
        .release-notes p {
          color: #94a3b8;
        }
        
        .step-content h4 {
          color: #f1f5f9;
        }
        
        .step-content p {
          color: #94a3b8;
        }
        
        .installation-step {
          border-bottom-color: #334155;
        }
        
        .faq-question {
          color: #f1f5f9;
        }
        
        .faq-answer {
          color: #94a3b8;
        }
        
        .faq-item {
          border-bottom-color: #334155;
        }
        
        .product-image-placeholder {
          background: linear-gradient(135deg, #1e3a5f 0%, #2563eb 100%);
          color: #bfdbfe;
        }
        
        .card p {
          color: #94a3b8;
        }
      }
      
      /* Product Image Section */
      .product-image-section {
        text-align: center;
        padding: 20px;
        background: linear-gradient(to bottom, #f8f9fa 0%, #ffffff 100%);
        border-radius: 8px;
      }
      
      .product-image-section img {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      }
      
      .product-image-placeholder {
        background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
        padding: 60px 20px;
        border-radius: 8px;
        color: #4f46e5;
        font-size: 14px;
        font-weight: 500;
      }
      
      /* Installation Steps */
      .installation-steps {
        padding: 0;
        max-width: 700px;
        margin: 0 auto;
      }
      
      .installation-step {
        display: flex;
        gap: 16px;
        margin-bottom: 20px;
        padding-bottom: 20px;
        border-bottom: 1px solid #e5e7eb;
      }
      
      .installation-step:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
      }
      
      .step-number {
        flex-shrink: 0;
        width: 32px;
        height: 32px;
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 14px;
      }
      
      .step-content h4 {
        margin: 0 0 8px 0;
        color: #111827;
        font-size: 16px;
        font-weight: 600;
      }
      
      .step-content p {
        margin: 0;
        color: #6b7280;
        font-size: 14px;
        line-height: 1.6;
      }
      
      /* FAQ Section */
      .faq-item {
        margin-bottom: 24px;
        padding-bottom: 24px;
        border-bottom: 1px solid #e5e7eb;
      }
      
      .faq-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
      }
      
      .faq-question {
        font-weight: 600;
        color: #111827;
        margin-bottom: 8px;
        font-size: 16px;
      }
      
      .faq-answer {
        color: #6b7280;
        line-height: 1.7;
      }
      
      .faq-answer a {
        color: #3b82f6;
        text-decoration: none;
      }
      
      .faq-answer a:hover {
        text-decoration: underline;
      }
      
      /* Professional Footer */
      .professional-footer {
        background: #1e293b;
        color: #94a3b8;
        padding: 48px 20px 24px;
        margin-top: 60px;
        border-top: 1px solid #334155;
      }
      
      .footer-content {
        max-width: 900px;
        margin: 0 auto;
      }
      
      .footer-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 32px;
        margin-bottom: 32px;
      }
      
      .footer-section h3 {
        color: #f1f5f9;
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      
      .footer-section ul {
        list-style: none;
        padding: 0;
      }
      
      .footer-section li {
        margin-bottom: 8px;
      }
      
      .footer-section a {
        color: #94a3b8;
        text-decoration: none;
        font-size: 14px;
        transition: color 0.2s ease;
      }
      
      .footer-section a:hover {
        color: #60a5fa;
      }
      
      .footer-bottom {
        border-top: 1px solid #334155;
        padding-top: 24px;
        text-align: center;
        font-size: 13px;
        color: #64748b;
      }
      
      .footer-bottom p {
        margin: 8px 0;
      }
      
      .footer-bottom a {
        color: #60a5fa;
        text-decoration: none;
      }
      
      .footer-bottom a:hover {
        text-decoration: underline;
      }
      
      /* Stats Badge */
      .stats-badge {
        display: inline-block;
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 600;
        margin: 16px 0;
        box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
      }
      
      .stats-badge .count {
        font-size: 18px;
        margin-left: 4px;
      }
    </style>
    
    <!-- Load ESP Web Tools component -->
    <script type="module">
      import "https://unpkg.com/esp-web-tools/dist/web/install-button.js?module";
    </script>
  </head>
  <body>
    <!-- Header -->
    <div class="header">
      <h1>RX5808-Div Firmware Configurator</h1>
      <p>Firmware management for RX5808 Diversity FPV drone video receivers</p>
    </div>

    <div class="container">
      <!-- About Section -->
      <div class="card">
        <h2>About</h2>
        <p>The <strong>RX5808 Diversity</strong> is a dual-receiver analog video system designed for FPV (First Person View) drone pilots. It features automatic diversity switching between two RX5808 receiver modules to maintain the strongest video signal, ensuring reliable real-time video feed during flight.</p>
        <p>This <strong>web-based configurator</strong> provides a simple way to flash and manage firmware on your RX5808-Div device directly from your browser‚Äîno software installation required. Update to the latest features, configure wireless control via ExpressLRS, customize band mappings, and more.</p>
        <div style="text-align: center;">
          <div class="stats-badge">
            üéØ Trusted by <span class="count" id="install-count">Loading...</span>+ pilots worldwide
          </div>
        </div>
      </div>
      
      <!-- Product Image -->
      <div class="card">
        <div class="product-image-section">
          <div class="product-image-placeholder">
            üì∑ Product Image Placeholder<br>
            <small style="opacity: 0.7;">RX5808 Diversity Receiver</small>
          </div>
        </div>
      </div>
      
      <!-- Key Features -->
      <div class="card">
        <h2>Key Features</h2>
        <div class="features">
          <div class="feature">
            <h3>ELRS Backpack Wireless Control</h3>
            <p>ExpressLRS wireless VRX integration via ESP-NOW protocol enables remote channel switching and settings control from your radio transmitter</p>
          </div>
          <div class="feature">
            <h3>Adaptive Diversity with Low-Latency</h3>
            <p>Optimized switching algorithms for Race (10ms low-latency), Freestyle (30ms balanced), and Long Range (100ms stable) modes tailored to your flying style</p>
          </div>
          <div class="feature">
            <h3>X-Band Custom Channels</h3>
            <p>Create and save your own custom band with frequently-used channels for instant access to your favorite frequencies across different bands</p>
          </div>
          <div class="feature">
            <h3>Spectrum Analyzer</h3>
            <p>Real-time visual RF spectrum display shows signal strength across all frequencies to identify interference, find clear channels, and optimize VTX setup</p>
          </div>
          <div class="feature">
            <h3>Quick Channel Scan</h3>
            <p>Rapidly scans all active channels and displays real-time RSSI strength for quick frequency identification and conflict detection</p>
          </div>
          <div class="feature">
            <h3>Diversity Calibration</h3>
            <p>Auto-calibration system adjusts RSSI thresholds and switching hysteresis for optimal diversity performance based on your receiver setup</p>
          </div>
        </div>
      </div>

      <!-- Installation Guide -->
      <div class="card">
        <h2>Installation Guide</h2>
        <div class="installation-steps">
          <div class="installation-step">
            <div class="step-number">1</div>
            <div class="step-content">
              <h4>Check Browser Compatibility</h4>
              <p>Use Chrome, Edge, or Opera browser with Web Serial API support. Safari and Firefox are not currently supported.</p>
            </div>
          </div>
          <div class="installation-step">
            <div class="step-number">2</div>
            <div class="step-content">
              <h4>Connect Your Device</h4>
              <p>Connect your RX5808-Div device to your computer via USB cable. The device should power on automatically.</p>
            </div>
          </div>
          <div class="installation-step">
            <div class="step-number">3</div>
            <div class="step-content">
              <h4>Select Firmware Version</h4>
              <p>Choose your desired firmware version from the dropdown menu below. The latest version is recommended for most users.</p>
            </div>
          </div>
          <div class="installation-step">
            <div class="step-number">4</div>
            <div class="step-content">
              <h4>Click Install and Select Port</h4>
              <p>Click the "Install" button, then select your device's COM port from the browser prompt. The firmware will flash automatically.</p>
            </div>
          </div>
          <div class="installation-step">
            <div class="step-number">5</div>
            <div class="step-content">
              <h4>Wait for Completion</h4>
              <p>The flashing process takes 1-2 minutes. Do not disconnect the device until you see the success message.</p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Firmware Installation -->
      <div class="card">
        <div class="version-header">
          <h2><span id="release-title">Loading...</span></h2>
          <select id="version-selector" class="version-selector">
            <option value="">Loading versions...</option>
          </select>
        </div>
        
        <div class="version-info">
          <span><strong>Release Date:</strong> <span id="release-date">-</span></span>
          <span><strong>Build:</strong> <span id="commit-hash">-</span></span>
        </div>
        
        <esp-web-install-button id="install-button">
          <button slot="activate" class="install-button">
            <span id="install-text">Loading...</span>
          </button>
        </esp-web-install-button>
        
        <p class="install-note">
          Connect your device via USB and click the button to begin firmware installation
        </p>
      </div>
      
      <!-- Release Notes -->
      <div class="card" id="whats-new-section">
        <h2>Release Notes: <span id="whats-new-version">v1.7.0</span></h2>
        <div id="release-notes" class="release-notes">
          <p style="text-align: center; color: #9ca3af;">Loading release information...</p>
        </div>
      </div>
      
      <!-- Support & FAQ -->
      <div class="card">
        <h2>Support & Troubleshooting</h2>
        <div class="faq-item">
          <div class="faq-question">‚ùì The install button doesn't work or shows an error</div>
          <div class="faq-answer">
            Make sure you're using Chrome, Edge, or Opera browser. Safari and Firefox do not support Web Serial API. If you're on Windows, you may need to install CH340 or CP2102 USB drivers for your device.
          </div>
        </div>
        <div class="faq-item">
          <div class="faq-question">‚ùì No serial port appears when I click Install</div>
          <div class="faq-answer">
            Verify your USB cable supports data transfer (not just charging). Try a different USB port or cable. Check Device Manager (Windows) or System Information (Mac) to confirm the device is recognized.
          </div>
        </div>
        <div class="faq-item">
          <div class="faq-question">‚ùì Installation failed or device won't boot after flashing</div>
          <div class="faq-answer">
            Try flashing again with "Erase device" option enabled. Ensure the device stays connected throughout the entire process. If problems persist, put the device in bootloader mode manually before flashing.
          </div>
        </div>
        <div class="faq-item">
          <div class="faq-question">‚ùì Which firmware version should I install?</div>
          <div class="faq-answer">
            We recommend installing the latest version for the newest features and bug fixes. If you experience issues with the latest version, you can downgrade to a previous stable release from the version dropdown.
          </div>
        </div>
        <div class="faq-item">
          <div class="faq-question">üí¨ Need more help?</div>
          <div class="faq-answer">
            For technical support, open an issue on <a href="https://github.com/LochnessFPV/RX5808-Div/issues" target="_blank">GitHub</a> or contact <a href="https://github.com/LochnessFPV" target="_blank">Lochness_FPV</a> directly through GitHub.
          </div>
        </div>
      </div>
      
      <!-- Footer -->
      <div class="footer">
        <p>
          <a href="https://github.com/LochnessFPV/RX5808-Div" target="_blank">Documentation</a> ‚Ä¢ 
          <a href="https://github.com/LochnessFPV/RX5808-Div/releases" target="_blank">Release History</a> ‚Ä¢ 
          <a href="https://github.com/LochnessFPV/RX5808-Div/issues" target="_blank">Support</a>
        </p>
        <p style="margin-top: 12px;">
          Created by <a href="https://github.com/LochnessFPV" target="_blank">Lochness_FPV</a> ‚Ä¢ Powered by ESP Web Tools
        </p>
      </div>
    </div>

    <!-- Professional Footer -->
    <footer class="professional-footer">
      <div class="footer-content">
        <div class="footer-grid">
          <div class="footer-section">
            <h3>Resources</h3>
            <ul>
              <li><a href="https://github.com/LochnessFPV/RX5808-Div" target="_blank">Documentation</a></li>
              <li><a href="https://github.com/LochnessFPV/RX5808-Div#readme" target="_blank">User Manual</a></li>
              <li><a href="https://github.com/LochnessFPV/RX5808-Div/releases" target="_blank">Release History</a></li>
              <li><a href="https://github.com/LochnessFPV/RX5808-Div/blob/main/CHANGELOG.md" target="_blank">Changelog</a></li>
            </ul>
          </div>
          <div class="footer-section">
            <h3>Support</h3>
            <ul>
              <li><a href="https://github.com/LochnessFPV/RX5808-Div/issues" target="_blank">Report an Issue</a></li>
              <li><a href="https://github.com/LochnessFPV/RX5808-Div/discussions" target="_blank">Community Discussions</a></li>
              <li><a href="https://github.com/LochnessFPV" target="_blank">Contact Developer</a></li>
              <li><a href="#whats-new-section">FAQ</a></li>
            </ul>
          </div>
          <div class="footer-section">
            <h3>Project</h3>
            <ul>
              <li><a href="https://github.com/LochnessFPV/RX5808-Div" target="_blank">Hardware Repository</a></li>
              <li><a href="https://github.com/LochnessFPV/RX5808-Div-Configurator" target="_blank">Configurator Source</a></li>
              <li><a href="https://github.com/LochnessFPV/RX5808-Div/blob/main/LICENSE" target="_blank">License (GPL-3.0)</a></li>
              <li><a href="https://github.com/LochnessFPV/RX5808-Div/graphs/contributors" target="_blank">Contributors</a></li>
            </ul>
          </div>
          <div class="footer-section">
            <h3>Legal</h3>
            <ul>
              <li><a href="https://github.com/LochnessFPV/RX5808-Div/blob/main/LICENSE" target="_blank">Terms of Use</a></li>
              <li><a href="https://github.com/site/privacy" target="_blank">Privacy Policy</a></li>
              <li><span style="opacity: 0.7;">Open Source Project</span></li>
              <li><span style="opacity: 0.7;">Community Driven</span></li>
            </ul>
          </div>
        </div>
        <div class="footer-bottom">
          <p>¬© 2024-2026 <a href="https://github.com/LochnessFPV" target="_blank">Lochness_FPV</a> ‚Ä¢ RX5808-Div Configurator</p>
          <p>Powered by <a href="https://esphome.github.io/esp-web-tools/" target="_blank">ESP Web Tools</a> ‚Ä¢ Built with ‚ù§Ô∏è for the FPV community</p>
        </div>
      </div>
    </footer>

    <script>
      // Analytics configuration - Replace with your Cloudflare Worker URL
      const ANALYTICS_ENDPOINT = 'https://rx5808-analytics.lochnessfpv.workers.dev';

      // Generate or retrieve visitor ID
      function getVisitorId() {
        let visitorId = localStorage.getItem('visitor_id');
        if (!visitorId) {
          visitorId = 'v_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
          localStorage.setItem('visitor_id', visitorId);
        }
        return visitorId;
      }

      // Get referrer (cleaned)
      function getReferrer() {
        const ref = document.referrer;
        if (!ref) return 'Direct';
        try {
          const url = new URL(ref);
          if (url.hostname.includes('google')) return 'Google';
          if (url.hostname.includes('facebook')) return 'Facebook';
          if (url.hostname.includes('reddit')) return 'Reddit';
          if (url.hostname.includes('twitter') || url.hostname.includes('x.com')) return 'Twitter';
          if (url.hostname.includes('youtube')) return 'YouTube';
          if (url.hostname === window.location.hostname) return 'Internal';
          return url.hostname;
        } catch (e) {
          return 'Unknown';
        }
      }

      // Track time on page
      let pageLoadTime = Date.now();
      window.addEventListener('beforeunload', () => {
        const timeOnPage = Math.round((Date.now() - pageLoadTime) / 1000); // seconds
        if (timeOnPage > 3 && timeOnPage < 3600) { // between 3s and 1h
          trackEvent('time_on_page', { timeOnPage, visitor_id: getVisitorId() });
        }
      });

      // Analytics tracking
      async function trackEvent(eventType, eventData = {}) {
        if (ANALYTICS_ENDPOINT === 'YOUR_WORKER_URL_HERE') {
          return; // Analytics not configured yet
        }
        
        try {
          await fetch(`${ANALYTICS_ENDPOINT}/track`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              event: eventType,
              visitor_id: getVisitorId(),
              referrer: getReferrer(),
              ...eventData,
            }),
          });
        } catch (error) {
          // Silently fail - don't interrupt user experience
          console.debug('Analytics tracking failed:', error);
        }
      }

      // Load and display visitor count
      async function loadInstallCount() {
        const countElement = document.getElementById('install-count');
        
        if (ANALYTICS_ENDPOINT === 'YOUR_WORKER_URL_HERE') {
          countElement.textContent = '1,000'; // Placeholder when analytics not configured
          console.log('Analytics endpoint not configured - using placeholder');
          return;
        }
        
        try {
          console.log('Fetching analytics from:', ANALYTICS_ENDPOINT + '/stats');
          const response = await fetch(`${ANALYTICS_ENDPOINT}/stats`);
          
          if (!response.ok) {
            console.error('Analytics endpoint returned:', response.status, response.statusText);
            countElement.textContent = '500+';
            return;
          }
          
          const data = await response.json();
          console.log('Analytics data received:', data);
          
          // Use page views or unique visitors (whichever is higher for better social proof)
          const count = Math.max(
            data.pageViews || 0,
            data.uniqueVisitors || 0,
            data.install_count || 0
          );
          
          // Format number with commas
          countElement.textContent = count > 0 ? count.toLocaleString() : '500+';
          console.log('Displaying count:', count);
        } catch (error) {
          console.error('Failed to load analytics:', error);
          countElement.textContent = '500+'; // Fallback display
        }
      }

      // Firmware version management
      let currentVersion = null;
      let allVersions = [];

      // Load latest firmware info on page load
      async function loadLatestVersion() {
        try {
          const response = await fetch('firmware/latest.json');
          const data = await response.json();
          currentVersion = data;
          updateUI(data);
          loadAvailableVersions();
        } catch (error) {
          console.error('Failed to load latest version:', error);
          showError();
        }
      }

      // Load all available versions for selector
      async function loadAvailableVersions() {
        try {
          const response = await fetch('firmware/versions.json');
          const data = await response.json();
          allVersions = data.versions;
          populateVersionSelector();
        } catch (error) {
          console.error('Failed to load versions:', error);
        }
      }

      // Populate version dropdown
      function populateVersionSelector() {
        const selector = document.getElementById('version-selector');
        selector.innerHTML = '';
        
        allVersions.forEach((ver, index) => {
          const option = document.createElement('option');
          option.value = ver.version;
          option.text = `${ver.version}${index === 0 ? ' (Latest)' : ''}`;
          selector.appendChild(option);
        });
        
        selector.value = currentVersion.version;
        selector.addEventListener('change', handleVersionChange);
      }

      // Handle version selection change
      async function handleVersionChange(event) {
        const selectedVersion = event.target.value;
        const versionData = allVersions.find(v => v.version === selectedVersion);
        
        // Track version selection
        trackEvent('version_selected', { version: selectedVersion });
        
        if (versionData) {
          // Load manifest for selected version
          try {
            const manifestResponse = await fetch(versionData.manifest_url);
            const manifestData = await manifestResponse.json();
            
            currentVersion = {
              version: versionData.version,
              build_date: manifestData.build_date,
              commit: manifestData.commit,
              release_date: versionData.release_date,
              description: versionData.description,
              manifest_url: versionData.manifest_url,
              changelog_url: manifestData.changelog_url
            };
            
            updateUI(currentVersion);
          } catch (error) {
            console.error('Failed to load version:', error);
          }
        }
      }

      // Update UI with version data
      function updateUI(data) {
        // Update title
        document.getElementById('release-title').textContent = `Latest Release: ${data.version}`;
        
        // Update version info
        const releaseDate = new Date(data.release_date || data.build_date).toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });
        document.getElementById('release-date').textContent = releaseDate;
        document.getElementById('commit-hash').textContent = data.commit;
        
        // Update install button
        document.getElementById('install-text').textContent = `Install Firmware ${data.version}`;
        document.getElementById('install-button').setAttribute('manifest', data.manifest_url);
        
        // Update "What's New" section
        document.getElementById('whats-new-version').textContent = data.version;
        loadReleaseNotes(data);
      }

      // Load release notes from GitHub API
      async function loadReleaseNotes(data) {
        const notesContainer = document.getElementById('release-notes');
        
        try {
          // Extract repo info from changelog URL
          const repoMatch = data.changelog_url?.match(/github\.com\/([^\/]+)\/([^\/]+)/);
          if (!repoMatch) {
            console.warn('Invalid changelog URL:', data.changelog_url);
            throw new Error('Invalid changelog URL');
          }
          
          const [, owner, repo] = repoMatch;
          const version = data.version;
          
          console.log(`Fetching release notes for ${owner}/${repo} ${version}...`);
          
          // Fetch release info from GitHub API
          const apiUrl = `https://api.github.com/repos/${owner}/${repo}/releases/tags/${version}`;
          const response = await fetch(apiUrl);
          
          if (!response.ok) {
            console.warn(`GitHub API returned ${response.status} for ${apiUrl}`);
            
            // Check if it's a rate limit issue
            if (response.status === 403) {
              const rateLimitRemaining = response.headers.get('X-RateLimit-Remaining');
              if (rateLimitRemaining === '0') {
                console.error('GitHub API rate limit exceeded');
                notesContainer.innerHTML = `<p>‚ö†Ô∏è GitHub API rate limit reached. Showing basic info:</p><p>${data.description || 'No description available.'}</p><p><a href="${data.changelog_url}" target="_blank">View full release notes on GitHub ‚Üí</a></p>`;
                return;
              }
            }
            
            throw new Error(`Release not found (${response.status})`);
          }
          
          const release = await response.json();
          console.log('Release data:', release);
          
          const body = release.body || data.description || 'No release notes available.';
          
          // If body is same as description, try to fetch from the changelog URL
          if (body === data.description && body.length < 100) {
            console.warn('Release body is empty or too short, showing description with link');
            notesContainer.innerHTML = `<p>${data.description}</p><p><a href="${data.changelog_url}" target="_blank">View full release notes on GitHub ‚Üí</a></p>`;
            return;
          }
          
          // Convert markdown to basic HTML
          const htmlNotes = convertMarkdownToHTML(body);
          notesContainer.innerHTML = htmlNotes;
        } catch (error) {
          console.error('Failed to load release notes:', error);
          notesContainer.innerHTML = `<p>${data.description || 'Release notes unavailable.'}</p><p><a href="${data.changelog_url}" target="_blank">View release notes on GitHub ‚Üí</a></p>`;
        }
      }

      // Simple markdown to HTML converter
      function convertMarkdownToHTML(markdown) {
        return markdown
          .split('\n')
          .map(line => {
            // Headers
            if (line.startsWith('###')) {
              return `<h4>${line.replace(/^###\s*/, '')}</h4>`;
            }
            if (line.startsWith('##')) {
              return `<h3>${line.replace(/^##\s*/, '')}</h3>`;
            }
            // Bullet points
            if (line.match(/^[‚Ä¢\-\*]\s/)) {
              return `<li>${line.replace(/^[‚Ä¢\-\*]\s*/, '')}</li>`;
            }
            // Empty lines
            if (line.trim() === '') {
              return '';
            }
            // Regular paragraphs
            return `<p>${line}</p>`;
          })
          .join('')
          .replace(/(<li>.*<\/li>)/gs, '<ul style="margin: 10px 0; padding-left: 20px;">$1</ul>');
      }

      // Show error state
      function showError() {
        document.getElementById('release-title').textContent = 'Error Loading Firmware';
        document.getElementById('install-text').textContent = 'Unable to load firmware';
        document.getElementById('release-notes').innerHTML = '<p style="color: #e53e3e;">Failed to load firmware information. Please try refreshing the page.</p>';
      }

      // Initialize on page load
      window.addEventListener('DOMContentLoaded', () => {
       loadLatestVersion();
        loadInstallCount();
        
        // Track page view
        trackEvent('page_view');
        
        // Setup ESP Web Tools event listeners for install tracking
        const installButton = document.getElementById('install-button');
        
        installButton.addEventListener('state-changed', (ev) => {
          const state = ev.detail.state;
          
          if (state === 'STATE_INITIALIZING') {
            // User clicked install button
            trackEvent('install_click', { version: currentVersion?.version || 'unknown' });
          } else if (state === 'STATE_FINISHED') {
            // Installation completed successfully
            trackEvent('install_success', { version: currentVersion?.version || 'unknown' });
          }
        });
        
        installButton.addEventListener('error-changed', (ev) => {
          if (ev.detail.error) {
            // Installation failed
            trackEvent('install_failed', { 
              version: currentVersion?.version || 'unknown',
              error: ev.detail.error
            });
          }
        });
      });
    </script>
  </body>
</html>
